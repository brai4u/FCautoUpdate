<!DOCTYPE html>
<html>

<head>
    <title>FlowCast</title>
    <script type="text/javascript" src="./js/global.js"></script>
    <script type="text/javascript" src="./js/jquery-3.1.0.min.js"></script>
    <script type="text/javascript" src="./js/servervideo.js"></script>
    <script type="text/javascript" src="./js/serversubs.js"></script>
    <script type="text/javascript" src="./js/serverimage.js"></script>
    <script type="text/javascript" src="./js/hook.js"></script>
    <script type="text/javascript" src="./js/deviceC.js"></script>
    <script type="text/javascript" src="./js/autoupdate.js"></script>


    <link rel="stylesheet" type="text/css" href="./css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="./css/bar.css">
    <link rel="stylesheet" type="text/css" href="./css/swag.css">

    <script type="text/javascript">
        $(document).ready(function() {
            startUpTime();
            loadchromecast();

            window.ondragover = function(e) {
                e.preventDefault();
                return false
            };
            window.ondrop = function(e) {
                e.preventDefault();
                return false
            };

            var holder = document.getElementById('holder');
            holder.ondragover = function() {
                $(this).attr("class", "holder-show");
                return false;
            };
            holder.ondragleave = function() {
                $(this).attr("class", "holder");
                return false;
            };
            holder.ondrop = function(e) {
                e.preventDefault();
                $(this).attr("class", "holder");
                for (var i = 0; i < e.dataTransfer.files.length; ++i) {
                    ext = e.dataTransfer.files[i].path.split('.').pop();
                    fullpath = e.dataTransfer.files[i].path
                    name = fullpath.substr(0, fullpath.length - 4);
                    console.log(name);
                    if (ext == "mp4" || ext == "mkv") {
                        CleanControlls();
                        FileName = fullpath.split('\\').pop();
                        $('#filename').html(FileName);
                        console.log("drop");
                        console.log(deviceStatus);
                        if (deviceStatus) {
                            console.log("d2");
                            console.log(deviceStatus);
                            dropVideo = fullpath;
                            startStreaming();
                        }

                        dropVideo = fullpath
                        fs.exists(name + '.srt', (exists) => {
                            if (exists) {
                                CreateSubs(name + '.srt');
                                $('#subSelect').prepend('<option selected value="' + name + '.srt' + '">' + name.split('\\').pop() + '.srt' + '</option>');
                                console.log("Subs with de the name loaded.");
                            } else {
                                console.log("No subs with the same name")
                            }
                        });

                    } else if (ext == "srt") {
                        CreateSubs(name + '.srt');
                        $('#subSelect').prepend('<option selected value="' + name + '.srt' + '">' + name.split('\\').pop() + '.srt' + '</option>');
                    }
                }
                return false;
            };
        });

        nw.Window.get().on('close', function() {
            if (deviceStatus) {
                stopStreaming();
            }
            this.close(true);

        });
    </script>
</head>

<body>
    <div id="noti">
    </div>
    <div id="toolbar">
        <span id="close"></span>
        <span id="min"></span>
        <span id="tooltext">Flow Cast</span>
    </div>
    <i id="videoFile" class="fa fa-file-video-o fa-2x" aria-hidden="true"></i>
    <div id="filename">
        Drag & drop a video here :)
    </div>
    <i id="subFile" class="fa fa-file-text-o fa-2x" aria-hidden="true"></i>
    <div id="subtitles-name">
        <select id="subSelect" onchange="SelectData(this);">
            <option value="nosubs"> No subs</option>
        </select>
    </div>
    <div id="pop">
        <span id="oops">
            <h1>Oops :(</h1>
            <br>
            I can't find your Google Chromecast. Its on?<br>
            <div id="tryagain">Ok, try again!</div>

        </span>
    </div>
    <div id="status" class="status-loading">
        <i id="chromecastIcon-big" class="fa fa-chrome fa-2x" aria-hidden="true"></i>
        <div id="ChromecastDevice">
            Searching chromecast
        </div>
    </div>
    <div id="progressbar" class="w3-progress-container w3-light-blue">
        <div id="progress" class="w3-progressbar w3-blue" style="width:0%"></div>
    </div>
    <div id="bar">
        <span id="timeStart">0:00:00</span>
        <div class="controlls center">
            <i id="backtoback" class="fa fa-step-backward fa-2x" aria-hidden="true"></i>
            <i id="back" class="fa fa-backward fa-2x" aria-hidden="true"></i>
            <i id="play" class="fa fa-play fa-3x" aria-hidden="true"></i>
            <i id="stop" class="fa fa-stop fa-3x" aria-hidden="true"></i>
            <i id="go" class="fa fa-forward fa-2x" aria-hidden="true"></i>
            <i class="fa fa-step-forward fa-2x" aria-hidden="true"></i>
        </div>
        <span id="timeEnd">0:00:00</span>
    </div>
    <div id="holder" class="holder">
        <div id="text-holder">
            <i class="fa fa-plus fa-5x" aria-hidden="true"></i>
        </div>
    </div>
</body>

</html>